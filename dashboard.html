<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/dash.css">
</head>
<body>
    <div class="container">
        <h1 class="text-center mt-5" id="heading">Dashboard</h1>
        
        <div class="dashboard-buttons text-center">
            <a href="/myresume.html">
            <button class="btn-primary">Create Resume</button>
            </a>
            <button class="logout-btn" onclick="logout()" id="mybutton">Logout</button>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    
    <!-- Dashboard JS -->
    <script>
        // Check if user is logged in
        const loggedInUser = JSON.parse(sessionStorage.getItem('loggedInUser'));
        if (!loggedInUser) {
            window.location.href = 'login.html';
        } else {
            document.getElementById('userGreeting').textContent = `Welcome, ${loggedInUser.fullName}!`;
            loadResumes();
        }

        function createResume() {
            window.location.href = 'myresume.html';
        }

        function logout() {
            sessionStorage.removeItem('loggedInUser');
            window.location.href = 'login.html';
        }

        function loadResumes() {
            const resumes = JSON.parse(localStorage.getItem(`resumes_${loggedInUser.email}`)) || [];
            const resumesList = document.getElementById('resumes-list');
            if (resumes.length === 0) {
                resumesList.innerHTML = '<p>No resumes created yet. Click "Create Resume" to get started!</p>';
                return;
            }
            resumesList.innerHTML = resumes.map((resume, index) => `
                <div class="resume-item mb-4 p-3 border rounded" style="background: rgba(255,255,255,0.9);">
                    <h4>${resume.name}'s Resume</h4>
                    <p><strong>Created:</strong> ${new Date(resume.timestamp).toLocaleString()}</p>
                    <button class="btn btn-secondary btn-sm mr-2" onclick="viewResume(${index})">View Full Resume</button>
                    <button class="btn btn-danger btn-sm" onclick="deleteResume(${index})">Delete</button>
                </div>
            `).join('');
        }

        function viewResume(index) {
            const resumes = JSON.parse(localStorage.getItem(`resumes_${loggedInUser.email}`)) || [];
            const resume = resumes[index];
            const fullResume = `
                <h2>${resume.name}</h2>
                <p><strong>Email:</strong> ${resume.email}</p>
                <p><strong>Phone:</strong> ${resume.phone}</p>
                ${resume.profileSummary ? `<h3>Profile Summary</h3><p>${resume.profileSummary.replace(/\n/g, '<br>')}</p>` : ''}
                ${resume.education ? `<h3>Education</h3><p>${resume.education.replace(/\n/g, '<br>')}</p>` : ''}
                <h3>Experience</h3><p>${resume.experience.replace(/\n/g, '<br>')}</p>
                ${resume.skills ? `<h3>Skills</h3><p>${resume.skills.replace(/\n/g, '<br>')}</p>` : ''}
                ${resume.languages ? `<h3>Languages</h3><p>${resume.languages.replace(/\n/g, '<br>')}</p>` : ''}
            `;
            alert(`Full Resume:\n\n${fullResume.replace(/<[^>]*>/g, '')}`); // Simple alert; could be a modal
        }

        function deleteResume(index) {
            if (confirm('Are you sure you want to delete this resume?')) {
                const resumes = JSON.parse(localStorage.getItem(`resumes_${loggedInUser.email}`)) || [];
                resumes.splice(index, 1);
                localStorage.setItem(`resumes_${loggedInUser.email}`, JSON.stringify(resumes));
                loadResumes();
            }
        }
//         function viewMyResume() { // New simple JS function
//     const resumesList = document.getElementById('resumes-list');
//     if (resumesList.style.display === 'none' || resumesList.style.display === '') {
//         resumesList.style.display = 'block'; // Show resumes
//     } else {
//         resumesList.style.display = 'none'; // Hide resumes
//     }
// }
// function viewMyResume() { // Updated: Opens the latest resume in a new window
//     const resumes = JSON.parse(localStorage.getItem(`resumes_${loggedInUser.email}`)) || [];
//     if (resumes.length === 0) {
//         alert('No resumes found. Create one first!');
//         return;
//     }
//     const latestResume = resumes[resumes.length - 1]; // Get the latest resume
//     const newWindow = window.open('', '_blank');
//     newWindow.document.write(latestResume.html);
//     newWindow.document.close();
// }

function viewResume(index) { // Updated: Opens the specific resume in a new window
    const resumes = JSON.parse(localStorage.getItem(`resumes_${loggedInUser.email}`)) || [];
    const resume = resumes[index];
    const newWindow = window.open('', '_blank');
    newWindow.document.write(resume.html);
    newWindow.document.close();
}

// ... (rest of the file remains the same) ...
    </script>
</body>
</html>